link  = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Set2")[c(1:5,7:9)])),linetype=1,size=1),
label = list(color="black"
,nudge_x=c(rep(-1,8),rep(0,10),rep(1,10),rep(0,6))
,nudge_y=c(rep(0,8),rep(-1,10),rep(0,10),rep(1,6))),
add   = theme(legend.position = "none",
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank()))
# define theme
theme_use <- theme(legend.position = "none",
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank()))
n <- 6
demo <- gen_demo(n_cross = n,n_node = 1:n, n_link = 1:(n-1), seed = 66)
nodes <- demo$nodes
head(nodes)
edges <- demo$edges
head(edges)
cross.by <- demo$cross.by
head(demo)
``` r
cl <- crosslink(nodes, edges, cross.by, odd.rm = F,spaces = "flank")
## Beautify nodes, lines through the interface 'cross', 'link','label' and 'header'.
## Beautify the figure as ggplot2 theme provided.
cl %>%
cl_plot(cross = list(mapping = aes(color = type,shape=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")),
shape = scale_shape_manual(values = 15:22)
),
size=10
),
link = list(color="grey55",size=1,linetype=3),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
))  -> p1
p1 + theme_use
# define theme
theme_use <- theme(legend.position = "none",
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank()))
# define theme
theme_use <- theme(legend.position = "none",
axis.title = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank())
## Beautify nodes, lines through the interface 'cross', 'link','label' and 'header'.
## Beautify the figure as ggplot2 theme provided.
cl %>%
cl_plot(cross = list(mapping = aes(color = type,shape=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")),
shape = scale_shape_manual(values = 15:22)
),
size=10
),
link = list(color="grey55",size=1,linetype=3),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
))  -> p1
p1 + theme_use
## Beautify nodes, lines through the interface 'cross', 'link','label' and 'header'.
## Beautify the figure as ggplot2 theme provided.
cl %>%
cl_plot(cross = list(mapping = aes(color = type,shape=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")),
shape = scale_shape_manual(values = 15:22)
),
size=10
),
link = list(color="grey55",size=1,linetype=3),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### a. layout by row
``` r
## set_space 设置后在图上看不出区别,不然去掉？？？
cl %>% #set_space(spaces=list(crossF="partition")) %>%
layout_row() %>%
cl_plot(cross = list(mapping = aes(color = type,fill=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))
,fill = scale_fill_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))
),
size=8,shape=24
),
link = list(color=RColorBrewer::brewer.pal(8, "Set2")[7],size=1.5,linetype=12),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### b. layout by rotate
``` r
cl %>%
tf_rotate(angle = 30, by.each.cross = T) %>%
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="grey75",size=1,linetype=15),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=1,linetype=3,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=3,linetype=3,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=3,linetype=2,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=10,linetype=2,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=10,linetype=1,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=3,linetype=3,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=2,linetype=3,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=1,linetype=3,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=1,linetype=13,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=1,linetype=15,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
#### c. layout by polygon
``` r
cl %>%
#set_header(header = c("s1","tar1","s2","tar2","s3","tar3")) %>%
layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=2,linetype=15,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
``` r
cl %>% layout_hive(angles=rep(60,6)) %>% #length of angles must be same with the numbers of groups
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=18
),
link  = list(color="purple",size=1,linetype=15),
label = list(color="white"),
header= list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add   = theme_use )
#### c. layout by polygon
``` r
cl %>% layout_polygon() %>%
#tf_rotate(angle = 45, by.each.cross = F) %>%  # If the grouping is 4, rotate by this parameter and change from diamond to square
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=16
),
link = list(color="orange",size=2,linetype=15,geom="curve"),
label = list(color="white"),
header = list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add=theme_use)
``` r
cl %>% layout_hive(angles=rep(60,6)) %>% #length of angles must be same with the numbers of groups
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=18
),
link  = list(color="purple",size=1,linetype=15),
label = list(color="white"),
header= list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add   = theme_use )
``` r
cl %>% layout_arc(angles=c(60,120,180),crosses=c("D","E","F")) %>% #length of angles must be same with the numbers of crosses
cl_plot(cross = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=10,shape=18
),
link  = list(color="orange",size=1,linetype=3),#,geom="curve"
label = list(color="white"),
header= list(mapping = aes(color= cross),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2"))),
size=5
),
add   =  theme_use)
``` r
source("R/example.R")
``` r
source("R/example1.R")
``` r
source("R/example1.R")
``` r
source("R/example1.R")
``` r
source("R/example1.R")
``` r
source("R/example1.R")
# generate data
# nodes
eg_nodes <- data.frame(
id = c(paste0("P", 1:30),
paste0("RBP", 1:20),
paste0("N", 1:30)),
type = c(rep("P1", 15),rep("P2", 15),
rep("RBP", 20),
rep("N1", 15),rep("N2", 15)),
maintype=c(rep("P", 30),
rep("RBP", 20),
rep("N", 30)),
strength=sample(3:10, 80, replace = T)
)
# edges
eg_edges <- data.frame(rbind(
# Positive pathway vs RBP
data.frame(
source = sample(eg_nodes$id[eg_nodes$type == "P1" | eg_nodes$type == "P2"],
replace = T, 100),
target = sample(eg_nodes$id[eg_nodes$type == "RBP"],
replace = T, 100),
maintype=rep("P",100)),
# Negative pathway vs RBP
data.frame(
source = sample(eg_nodes$id[eg_nodes$type == "N1" | eg_nodes$type == "N2"],
replace = T, 100),
target = sample(eg_nodes$id[eg_nodes$type == "RBP"],
replace = T, 100),
maintype=rep("N",100))
))
``` r
source("R/example1.R")
cl <- crosslink(eg_nodes, eg_edges, cross.by="type", odd.rm = F,)
cl %>% cl_plot(cross = list(mapping = aes(color = type, shape = type,size=strength,fill=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")),
fill = scale_fill_manual(values = RColorBrewer::brewer.pal(8, "Dark2")),
shape = scale_shape_manual(values = c(15:18,25)),
size=scale_size_continuous(range=c(1,8))
)
),
link = list(mapping = aes(color = maintype),size=0.5,linetype=8,
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Set2")))),
label = list(color="black"),
add   =  theme_use)
```
theme_classic() +
theme(axis.text.x = element_blank(),
axis.line.x = element_blank(),
axis.ticks.x = element_blank()) ->theme_use2
source("R/data.R")
theme_classic() +
theme(axis.text.x = element_blank(),
axis.line.x = element_blank(),
axis.ticks.x = element_blank()) ->theme_use2
## crosslink project
cl <- crosslink(nodes,edges,cross.by="type")
cl %>% cl_plot()
cl <- set_header(cl,header=unique(get_cross(cl)$cross))
cl %>% layout_polygon(crosses = c("Mir","Meth","Gene","Drug"),layout_based = "default") %>%
tf_rotate(crosses= c("Mir","Meth","Gene","Drug"),angle = rep(45,4),layout="default") %>%
tf_shift(x=0.2*(-1),y=1.5,crosses=c("Mir","Meth"),layout="default") -> cl
# plot annotation
top <- nodes$id[nodes$type == "Mir"] # set the order as you like
bottom <- nodes$id[nodes$type == "Gene"] # set the order as you like
right <- nodes$id[nodes$type == "Meth"] # set the order as you like
# Top plot
topAnn <-  mirData %>%
mutate(mir_f = factor(mir, top)) %>%
ggplot(mapping = aes(x=mir,y=-lfc)) +
geom_bar(fill = "#E7298A",
stat = "identity",
width = 0.5) + # 间距跟bar同宽
labs(x = NULL, y = "log2(Fold Change)") +
theme_use2
topAnn
# left plot
mat = matrix(sample(1:100, 64, replace = T), nrow = 8)
colnames(mat)=as.character(cl@cross$Drug)
lftAnno <- ggplot(data = melt(mat), aes(X1, X2, fill = value))+
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "darkgreen", mid = "white",midpoint = 0) +
xlab("")+ylab("")+
theme_use2
# left plot
mat = matrix(sample(1:100, 64, replace = T), nrow = 8)
colnames(mat)=as.character(cl@cross$Drug)
lftAnno <- ggplot(data = melt(mat), aes(X1, X2, fill = value))+
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "darkgreen", mid = "white",midpoint = 0) +
xlab("")+ylab("")+
theme_use2
lftAnno
cl_plot(cl,
annotation=cl_annotation(top = topAnn,top.by = "Mir",top.height = 0.5,
bottom = botAnn,bottom.by = "Gene",bottom.height = 0.5,
right = rgtAnn,right.by ="Meth",right.width = 0.5,
left = lftAnno,left.by = "Drug" ,left.width = 0.5),
cross = list( mapping = aes(color = type,size=degree,shape=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")[c(1:5,7:9)]),
shape = scale_shape_manual(values = 15:23),
size  = scale_size_continuous(range=c(1,5)))),
link  = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Set2")[c(1:5,7:9)])),linetype=1,size=1),
label = list(color="black"
,nudge_x=c(rep(-1,8),rep(0,10),rep(1,10),rep(0,6))
,nudge_y=c(rep(0,8),rep(-1,10),rep(0,10),rep(1,6))),
add   =  theme_use)
# left plot
mat = matrix(sample(1:100, 64, replace = T), nrow = 8)
colnames(mat)=as.character(cl@cross$Drug)
ggplot(data = melt(mat), aes(X1, X2, fill = value))+
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "darkgreen", mid = "white",midpoint = 0) +
xlab("")+ylab("")+theme_classic()+
theme(legend.position = "right",
axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank()) -> lftAnno
cl_plot(cl,
annotation=cl_annotation(top = topAnn,top.by = "Mir",top.height = 0.5,
bottom = botAnn,bottom.by = "Gene",bottom.height = 0.5,
right = rgtAnn,right.by ="Meth",right.width = 0.5,
left = lftAnno,left.by = "Drug" ,left.width = 0.5),
cross = list( mapping = aes(color = type,size=degree,shape=type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Dark2")[c(1:5,7:9)]),
shape = scale_shape_manual(values = 15:23),
size  = scale_size_continuous(range=c(1,5)))),
link  = list(mapping = aes(color = type),
scale = list(color = scale_color_manual(values = RColorBrewer::brewer.pal(8, "Set2")[c(1:5,7:9)])),linetype=1,size=1),
label = list(color="black"
,nudge_x=c(rep(-1,8),rep(0,10),rep(1,10),rep(0,6))
,nudge_y=c(rep(0,8),rep(-1,10),rep(0,10),rep(1,6))),
add   =  theme_use)
pkgdown::build_site()
pkgdown::build_site()
